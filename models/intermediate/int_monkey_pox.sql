SELECT
    mform_id::text AS mform_id,
    form_id::text AS form_id,
    case_unique_id::text AS case_unique_id,
    created_username::text AS created_username,
    created_timestamp::text AS created_timestamp,
    modified_username::text AS modified_username,
    modified_timestamp::text AS modified_timestamp,
    location_accuracy::text AS location_accuracy,
    location_latitude::text AS location_latitude,
    location_longitude::text AS location_longitude,
    syndrome::text AS syndrome,
    disease::text AS disease,
    CASE WHEN clinical_information_date_of_onset ~ '^\d{2}/\d{2}/\d{4}$' THEN to_timestamp(clinical_information_date_of_onset, 'DD/MM/YYYY')::date ELSE NULL END AS case_date,
    CASE WHEN clinical_information_date_of_onset ~ '^\d{2}/\d{2}/\d{4}$' THEN to_char(to_timestamp(clinical_information_date_of_onset, 'DD/MM/YYYY'), 'YYYY "W"IW') ELSE NULL END AS epi_week,
    epid::text AS epid,
    date_of_investigation::text AS date_of_investigation,
    location_of_investigation::text AS location_of_investigation,
    location_of_investigation_other::text AS location_of_investigation_other,
    case_demographics_family::text AS family_name,
    case_demographics_given::text AS given_name,
    case_demographics_sex::text AS sex,
    CASE 
        WHEN age_years ~ '^[0-9]+(\.[0-9]+)?$' THEN age_years::float
        ELSE NULL
    END AS age_years,
    CASE 
        WHEN age_months ~ '^[0-9]+(\.[0-9]+)?$' THEN age_months::float
        ELSE NULL
    END AS age_months,
    CASE
        WHEN NOT (age_years ~ '^[0-9]+(\.[0-9]+)?$') THEN 'Unknown'
        WHEN age_years::float < 2 THEN '0-2 yrs'
        WHEN age_years::float BETWEEN 2 AND 5 THEN '2-5 yrs'
        WHEN age_years::float BETWEEN 5 AND 16 THEN '5-16 yrs'
        WHEN age_years::float > 16 THEN '16+ yrs'
        ELSE 'Unknown'
    END AS age_group,
    case_demographics_date_of_birth::text AS date_of_birth,
    case_demographics_age_years::text AS age_years,
    case_demographics_age_months::text AS age_months,
    case_demographics_age_days::text AS age_days,
    case_demographics_case_is_pregnant::text AS pregnant,
    case_demographics_phone_number::text AS phone_number,
    case_demographics_occupation::text AS occupation,
    case_demographics_occupation_other::text AS occupation_other,
    case_demographics_title_residence::text AS title_residence,
    case_demographics_country::text AS country,
    case_demographics_county::text AS county,
    case_demographics_subcounty::text AS subcounty,
    case_demographics_ward::text AS ward,
    case_demographics_town_village_camp::text AS town_village_camp,
    case_demographics_landmark::text AS landmark,
    case_demographics_title_parent_guradian::text AS title_parent_guradian,
    case_demographics_guardian_family_name::text AS guardian_family_name,
    case_demographics_guardian_given_name::text AS guardian_given_name,
    case_demographics_guardian_phone_number::text AS guardian_phone_number,
    case_demographics_title_respondent::text AS title_respondent,
    case_demographics_respondent::text AS respondent,
    case_demographics_respondent_family_name::text AS respondent_family_name,
    case_demographics_respondent_given_name::text AS respondent_given_name,
    case_demographics_respondent_address::text AS respondent_address,
    case_demographics_respondent_phone_number::text AS respondent_phone_number,
    case_demographics_respondent_relationship::text AS respondent_relationship,
    clinical_information_symptoms::text AS symptoms,
    clinical_information_symptoms_other::text AS symptoms_other,
    clinical_information_fever_temperature::text AS fever_temperature,
    clinical_information_locations_of_lymphadenopathy::text AS locations_of_lymphadenopathy,
    clinical_information_date_of_onset::text AS date_of_onset,
    clinical_information_title_clinical_care::text AS title_clinical_care,
    clinical_information_type_of_care::text AS type_of_care,
    clinical_information_case_is_isolated::text AS case_is_isolated,
    clinical_information_health_facility_name::text AS health_facility_name,
    clinical_information_date_of_admission::text AS date_of_admission,
    clinical_information_inpatient_number::text AS inpatient_number,
    clinical_information_date_first_seen_at_facility::text AS date_first_seen_at_facility,
    clinical_information_outpatient_number::text AS outpatient_number,
    clinical_information_outcome_of_patient::text AS outcome_of_patient,
    clinical_information_status_of_patient::text AS status_of_patient,
    clinical_information_date_of_discharge::text AS date_of_discharge,
    clinical_information_date_of_death::text AS date_of_death,
    clinical_information_place_of_death::text AS place_of_death,
    exposure_information_type_of_exposure::text AS type_of_exposure,
    exposure_information_type_of_contact::text AS type_of_contact,
    exposure_information_contact_was_symptomatic::text AS contact_was_symptomatic,
    exposure_information_date_of_contact::text AS date_of_contact,
    exposure_information_frequency_of_contact::text AS frequency_of_contact,
    exposure_information_duration_of_contact::text AS duration_of_contact,
    exposure_information_location_of_contact::text AS location_of_contact,
    exposure_information_location_of_contact_other::text AS location_of_contact_other,
    exposure_information_relationship_of_contact::text AS relationship_of_contact,
    exposure_information_relationship_of_contact_other::text AS relationship_of_contact_other,
    exposure_information_title_ppe::text AS title_ppe,
    exposure_information_case_was_wearing_ppe::text AS case_was_wearing_ppe,
    exposure_information_ppe_items_worn::text AS ppe_items_worn,
    exposure_information_ppe_breach::text AS ppe_breach,
    exposure_information_hand_hygiene_before_wearing_ppe::text AS hand_hygiene_before_wearing_ppe,
    exposure_information_hand_hygiene_after_wearing_ppe::text AS hand_hygiene_after_wearing_ppe,
    exposure_information_animal_species::text AS animal_species,
    exposure_information_animal_species_other::text AS animal_species_other,
    exposure_information_animal_exposure::text AS animal_exposure,
    exposure_information_animal_exposure_other::text AS animal_exposure_other,
    exposure_information_date_of_exposure::text AS date_of_exposure,
    laboratory_information_samples_were_collected::text AS samples_were_collected,
    laboratory_information_samples_collected::text AS samples_collected,
    laboratory_information_samples_collected_other::text AS samples_collected_other,
    laboratory_information_date_of_sample_collection::text AS date_of_sample_collection,
    laboratory_information_tests::text AS tests,
    laboratory_information_test_other::text AS test_other,
    laboratory_information_result_of_laboratory_test::text AS result_of_laboratory_test,
    laboratory_information_date_of_laboratory_testing_results::text AS date_of_laboratory_testing_results,
    laboratory_information_facility_name::text AS facility_name,
    laboratory_information_facility_name_other::text AS facility_name_other,
    vaccination_information_smallpox_mpox_vaccine_received::text AS smallpox_mpox_vaccine_received,
    vaccination_information_number_of_doses::text AS number_of_doses,
    vaccination_information_date_of_first_dose::text AS date_of_first_dose,
    vaccination_information_brand_of_vaccine::text AS brand_of_vaccine
FROM {{ ref('stg_monkey_pox') }}
WHERE clinical_information_date_of_onset IS NOT NULL
