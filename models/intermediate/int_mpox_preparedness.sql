SELECT
    doc_id::text AS id,
    parent_ident::text AS parent_id,
    county || ' (' || date_of_entry || ')' AS contact_tree_label,
    mform_id::text AS mform_id,
    mform_event::text AS mform_event,
    event_ident::text AS event_id,
    form_id::text AS form_id,
    case_unique_id::text AS case_unique_id,
    (CASE WHEN df_complete::text = 'true' THEN 'Complete' ELSE 'Draft' END)::text AS completed,
    (CASE WHEN df_parent_complete::text = 'true' THEN 'Complete' ELSE 'Draft' END)::text AS parent_completed,
    created_role::text AS created_role,
    modified_role::text AS modified_role,
    created_username::text AS created_username,
    created_timestamp::text AS created_timestamp,
    modified_username::text AS modified_username,
    modified_timestamp::text AS modified_timestamp,
    location_accuracy::text AS location_accuracy,
    location_latitude::text AS location_latitude,
    location_longitude::text AS location_longitude,
    ''::text AS syndrome,
    'Mpox'::text AS disease,
    county::text AS county,
    date_of_entry::text AS date_of_entry,
    CASE WHEN date_of_entry ~ '^\d{2}/\d{2}/\d{4}$' THEN to_timestamp(date_of_entry, 'DD/MM/YYYY')::date ELSE NULL END AS case_date,
    CASE WHEN date_of_entry ~ '^\d{2}/\d{2}/\d{4}$' THEN to_char(to_timestamp(date_of_entry, 'DD/MM/YYYY'), 'YYYY "W"IW') ELSE NULL END AS epi_week,
    is_there_a_confirmed_case_of_mpox::text AS is_there_a_confirmed_case_of_mpox,
    ipc_committee_established::text AS ipc_committee_established,
    ipc_committee_disseminated_guidelines::text AS ipc_committee_disseminated_guidelines,
    hcw_infection_surveillance_system::text AS hcw_infection_surveillance_system,
    essential_ipc_materials_available::text AS essential_ipc_materials_available,
    ipc_comment::text AS ipc_comment,
    rcce_strategy_implemented::text AS rcce_strategy_implemented,
    rcce_co_ordination_mechanism::text AS rcce_co_ordination_mechanism,
    rcce_key_messages_developed::text AS rcce_key_messages_developed,
    rcce_community_feedback::text AS rcce_community_feedback,
    rcce_partners_mechanism::text AS rcce_partners_mechanism,
    rcce_targeted_vulnerable_groups::text AS rcce_targeted_vulnerable_groups,
    rcce_comments::text AS rcce_comments,
    lab_functional_capacity::text AS lab_functional_capacity,
    lab_clade_differentiation::text AS lab_clade_differentiation,
    lab_local_transport_mechanism::text AS lab_local_transport_mechanism,
    lab_trained_personnel_iata::text AS lab_trained_personnel_iata,
    lab_personnel_trained_safety::text AS lab_personnel_trained_safety,
    lab_pcr_reagents::text AS lab_pcr_reagents,
    lab_biosafety_equipment::text AS lab_biosafety_equipment,
    lab_workers_trained_correct_collection::text AS lab_workers_trained_correct_collection,
    lab_comment::text AS lab_comment,
    ops_support_strategy_for_rrt::text AS ops_support_strategy_for_rrt,
    ops_logistic_readiness_plan::text AS ops_logistic_readiness_plan,
    ops_end_to_end_mechanism::text AS ops_end_to_end_mechanism,
    ops_standard_mpox_kit::text AS ops_standard_mpox_kit,
    ops_storage_transport_capacities::text AS ops_storage_transport_capacities,
    ops_capacity_building_logistics::text AS ops_capacity_building_logistics,
    ops_county_logistics_expertise::text AS ops_county_logistics_expertise,
    ops_comment::text AS ops_comment,
    vxn_vaccination_strategy_county::text AS vxn_vaccination_strategy_county,
    vxn_refresher_trainings_health_workers::text AS vxn_refresher_trainings_health_workers,
    coord_established_mechanism::text AS coord_established_mechanism,
    coord_flow_charts::text AS coord_flow_charts,
    coord_contingency_plan::text AS coord_contingency_plan,
    coord_pheoc_activated::text AS coord_pheoc_activated,
    coord_mapping_of_capacities::text AS coord_mapping_of_capacities,
    coord_mechanism_resource_mobilize::text AS coord_mechanism_resource_mobilize,
    coord_rapid_risk_assessment::text AS coord_rapid_risk_assessment,
    coord_table_top_drills::text AS coord_table_top_drills,
    coord_operational_research::text AS coord_operational_research,
    coord_hiv_aids_inclusion::text AS coord_hiv_aids_inclusion,
    coord_comment::text AS coord_comment,
    srv_mpox_in_priority_diseases::text AS srv_mpox_in_priority_diseases,
    srv_mpox_in_idsr_form::text AS srv_mpox_in_idsr_form,
    srv_community_case_definition::text AS srv_community_case_definition,
    srv_mpox_standard_case_defs::text AS srv_mpox_standard_case_defs,
    srv_alert_management_system::text AS srv_alert_management_system,
    srv_event_based_surveillance::text AS srv_event_based_surveillance,
    srv_reporting_tools_for_mpox::text AS srv_reporting_tools_for_mpox,
    srv_multi_displ_teams::text AS srv_multi_displ_teams,
    srv_surveillance_capacity::text AS srv_surveillance_capacity,
    srv_proportion_sub_county_weekly_reports::text AS srv_proportion_sub_county_weekly_reports,
    srv_plans_for_sexual_transmission::text AS srv_plans_for_sexual_transmission,
    poe_sensitization_officers::text AS poe_sensitization_officers,
    poe_contingency_plan::text AS poe_contingency_plan,
    poe_medical_services_for_ill_travellers::text AS poe_medical_services_for_ill_travellers,
    poe_sop_referral_systems::text AS poe_sop_referral_systems,
    poe_multi_sector_mechanism::text AS poe_multi_sector_mechanism,
    poe_communication_materials::text AS poe_communication_materials,
    poe_coordination_one_health::text AS poe_coordination_one_health,
    poe_comment::text AS poe_comment,
    cm_designated_treatment_centre::text AS cm_designated_treatment_centre,
    cm_referral_protocols::text AS cm_referral_protocols,
    cm_psychosocial_services::text AS cm_psychosocial_services,
    cm_rapidly_converted_wards::text AS cm_rapidly_converted_wards,
    cm_case_management_team_trained::text AS cm_case_management_team_trained,
    cm_trained_hcws::text AS cm_trained_hcws,
    cm_case_definition_guidelines::text AS cm_case_definition_guidelines,
    cm_screening_tools::text AS cm_screening_tools,
    cm_medical_countermeasures::text AS cm_medical_countermeasures,
    cm_hiv_inclusion_guidelines::text AS cm_hiv_inclusion_guidelines,
    cm_comment::text AS cm_comment,
    rep_tools_adapted_disseminated::text AS rep_tools_adapted_disseminated,
    rep_tools_case_report_forms::text AS rep_tools_case_report_forms,
    rep_tools_case_investigation_forms::text AS rep_tools_case_investigation_forms,
    rep_tools_line_listing_form::text AS rep_tools_line_listing_form,
    rep_tools_contact_tracing_forms::text AS rep_tools_contact_tracing_forms,
    case_defs_adapted_disseminated::text AS case_defs_adapted_disseminated,
    case_defs_standard_in_use::text AS case_defs_standard_in_use,
    case_defs_community_defs_adapted::text AS case_defs_community_defs_adapted,
    case_defs_community_in_use::text AS case_defs_community_in_use,
    case_defs_hiv_included::text AS case_defs_hiv_included
FROM {{ ref('stg_mpox_preparedness') }}
